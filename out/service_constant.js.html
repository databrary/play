<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Frontend Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: service/constant.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Generate constants.
 * @namespace constantService
 */

'use strict';

app.factory('constantService', [
  '$log', '$sce', 'constantData', 'messageData',
  function ($log, $sce, constants, messages) {

    messages.get = function (k) {
      if (typeof k === 'string')
        k = k.split('.');
      var m = this;
      for (var i = 0; m &amp;&amp; i &lt; k.length; i ++)
        m = m[k[i]];
      return m;
    };
    constants.messages = messages;

    constants.regex = {
      doi: /^(?:[dD][oO][iI]:|[hH][dD][lL]:|(?:http:\/\/)?dx\.doi\.org\/)?(10\.[0-9\.]+\/\S+)\s*$/,
    };

    //

    function invertArray(data) {
      for (var i = 0; i &lt; data.length; i ++)
        data[data[i]] = i;
    }

    constants.releases = Object.keys(constants.release);
    constants.release[-1] = 'UNRELEASED';
    constants.releases.unshift('-1');
    invertArray(constants.permission);
    invertArray(constants.release);
    invertArray(constants.delivery);
    constants.categories = _.sortBy(constants.category, 'id');
    constants.categoryName = _.indexBy(constants.category, 'name');

    /* convenient aliases: */
    constants.permission.VIEW = constants.permission.PUBLIC;
    constants.permission.CONTRIBUTE = constants.permission.EDIT;
    constants.permission.SUPER = constants.permission.length;

    /* backwards compatibility: */
    for (var name in constants.party) {
      var uname = name.toUpperCase();
      var party = constants.party[name];
      if (typeof party === 'object' &amp;&amp; name !== uname)
        constants.party[uname] = party.id;
    }

    var msgnot = messages.not;
    for (var c in constants.category) {
      var cat = constants.category[c];
      var n = cat.name;
      cat.not = n in msgnot ? msgnot[n] : 'No ' + n;
      var metrics = _.filter(constants.metric, 'category', cat.id);
      cat.metrics = _.sortBy(metrics, 'id');
      cat.metricName = _.indexBy(metrics, 'name');
      if (cat.metrics[0].type === 'void')
        cat.indicator = cat.metrics[0];
    }

    for (var f in constants.format) {
      var fmt = constants.format[f];
      var m = fmt.mimetype;
      fmt.type = m.slice(0, m.indexOf('/'));
    }

    constants.accessPreset = [
      [constants.permission.NONE,   constants.permission.NONE],
      [constants.permission.PUBLIC, constants.permission.SHARED],
      [constants.permission.PUBLIC, constants.permission.SHARED]
    ];
    constants.accessPreset.parties = [
      constants.party.NOBODY,
      constants.party.ROOT
    ];
    constants.accessPreset.staff = constants.permission.EDIT;

    constants.message = function (key /*, args...*/) {
      var msg = messages.get(key);

      if (msg === undefined) {
        $log.info('Message key [' + key + '] is undefined.');
        return '[' + key + ']';
      }

      var i = 1, l = arguments.length;
      var o;
      if (i &lt; l &amp;&amp; typeof arguments[i] === 'object')
        o = arguments[i++];
      else
        o = {};

      var g = o.sce ? $sce.getTrusted.bind($sce, o.sce) : angular.identity;
      for (var n = 0; i &lt; l; i++, n++)
        msg = msg.replace('{' + n + '}', g(arguments[i]), 'g');
      if (o.sce)
        msg = $sce.trustAs(o.sce, msg);

      return msg;
    };

    constants.age = { day: 1, week: 7, year: 365.24219 };
    constants.age.month = constants.age.year / 12;
    constants.age.limit = constants.age.year * 90;

    function deepFreeze(o) {
      Object.freeze(o);
      for (var f in o)
        if (o.hasOwnProperty(f)) {
          var v = o[f];
          if (v instanceof Object &amp;&amp; !Object.isFrozen(v))
            deepFreeze(v);
        }
      return o;
    }
    constants.deepFreeze = deepFreeze;

    return deepFreeze(constants);
  }
]);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Databrary Frontend AngularJS</a></h2><div><h3>Directives</h3><ul><li><a href="module-directive_clickElsewhere.html">directive/clickElsewhere</a></li><li><a href="module-directive_fileModel.html">directive/fileModel</a></li><li><a href="module-directive_focus.html">directive/focus</a></li><li><a href="module-directive_fold.html">directive/fold</a></li><li><a href="module-directive_form.html">directive/form</a></li><li><a href="module-directive_formCtrl.html">directive/formCtrl</a></li><li><a href="module-directive_hint.html">directive/hint</a></li><li><a href="module-directive_homeContainer.html">directive/homeContainer</a></li><li><a href="module-directive_inputDate.html">directive/inputDate</a></li><li><a href="module-directive_keypress.html">directive/keypress</a></li><li><a href="module-directive_message.html">directive/message</a></li><li><a href="module-directive_mousedrag.html">directive/mousedrag</a></li><li><a href="module-directive_scrollFloat.html">directive/scrollFloat</a></li><li><a href="module-directive_setContents.html">directive/setContents</a></li><li><a href="module-directive_tooltip.html">directive/tooltip</a></li><li><a href="module-directive_validator.html">directive/validator</a></li><li><a href="module-directive_video.html">directive/video</a></li><li><a href="module-party_authApply.html">party/authApply</a></li><li><a href="module-party_authGrant.html">party/authGrant</a></li><li><a href="module-party_authSearch.html">party/authSearch</a></li><li><a href="module-party_comments.html">party/comments</a></li><li><a href="module-party_data.html">party/data</a></li><li><a href="module-party_editAccount.html">party/editAccount</a></li><li><a href="module-party_editApply.html">party/editApply</a></li><li><a href="module-party_editGrant.html">party/editGrant</a></li><li><a href="module-party_editNotifications.html">party/editNotifications</a></li><li><a href="module-party_editProfile.html">party/editProfile</a></li><li><a href="module-party_load.html">party/load</a></li><li><a href="module-party_loginForm.html">party/loginForm</a></li><li><a href="module-party_network.html">party/network</a></li><li><a href="module-party_portrait.html">party/portrait</a></li><li><a href="module-party_userPasswordForm.html">party/userPasswordForm</a></li><li><a href="module-site_activity.html">site/activity</a></li><li><a href="module-site_activityChange.html">site/activityChange</a></li><li><a href="module-site_commentReply.html">site/commentReply</a></li><li><a href="module-site_displayAge.html">site/displayAge</a></li><li><a href="module-site_errors.html">site/errors</a></li><li><a href="module-site_figure.html">site/figure</a></li><li><a href="module-site_frame.html">site/frame</a></li><li><a href="module-site_inputAge.html">site/inputAge</a></li><li><a href="module-site_inputCompleter.html">site/inputCompleter</a></li><li><a href="module-site_notifications.html">site/notifications</a></li><li><a href="module-site_panel.html">site/panel</a></li><li><a href="module-site_searchForm.html">site/searchForm</a></li><li><a href="module-site_tagAdd.html">site/tagAdd</a></li><li><a href="module-site_tags.html">site/tags</a></li><li><a href="module-site_toolbar.html">site/toolbar</a></li><li><a href="module-site_tooltip.html">site/tooltip</a></li><li><a href="module-site_wizard.html">site/wizard</a></li><li><a href="module-site_wizardStep.html">site/wizardStep</a></li><li><a href="module-volume_accessGrant.html">volume/accessGrant</a></li><li><a href="module-volume_accessSearch.html">volume/accessSearch</a></li><li><a href="module-volume_assist.html">volume/assist</a></li><li><a href="module-volume_cite.html">volume/cite</a></li><li><a href="module-volume_comments.html">volume/comments</a></li><li><a href="module-volume_design.html">volume/design</a></li><li><a href="module-volume_editAccess.html">volume/editAccess</a></li><li><a href="module-volume_editFunding.html">volume/editFunding</a></li><li><a href="module-volume_editLinks.html">volume/editLinks</a></li><li><a href="module-volume_editOverview.html">volume/editOverview</a></li><li><a href="module-volume_excerpts.html">volume/excerpts</a></li><li><a href="module-volume_filter.html">volume/filter</a></li><li><a href="module-volume_fundingGrant.html">volume/fundingGrant</a></li><li><a href="module-volume_fundingSearch.html">volume/fundingSearch</a></li><li><a href="module-volume_list.html">volume/list</a></li><li><a href="module-volume_metadata.html">volume/metadata</a></li><li><a href="module-volume_meter.html">volume/meter</a></li><li><a href="module-volume_meterCanvas.html">volume/meterCanvas</a></li><li><a href="module-volume_overview.html">volume/overview</a></li><li><a href="module-volume_owners.html">volume/owners</a></li><li><a href="module-volume_pivot.html">volume/pivot</a></li><li><a href="module-volume_showInvestigators.html">volume/showInvestigators</a></li><li><a href="module-volume_slot.html">volume/slot</a></li><li><a href="module-volume_spreadsheet.html">volume/spreadsheet</a></li></ul></div><div><h3>Services</h3><ul><li><a href="analyticService.html">analyticService</a></li><li><a href="authService.html">authService</a></li><li><a href="constantService.html">constantService</a></li><li><a href="displayService.html">displayService</a></li><li><a href="messageService.html">messageService</a></li><li><a href="modelService.html">modelService</a></li><li><a href="Offset.html">Offset</a></li><li><a href="pageService.html">pageService</a></li><li><a href="play.html">play</a></li><li><a href="routerService.html">routerService</a></li><li><a href="searchService.html">searchService</a></li><li><a href="Segment.html">Segment</a></li><li><a href="storageService.html">storageService</a></li><li><a href="styleService.html">styleService</a></li><li><a href="tooltipService.html">tooltipService</a></li><li><a href="uploadService.html">uploadService</a></li></ul></div><div><h3>Controllers</h3><ul><li><a href="party_activity.html">party/activity</a></li><li><a href="party_edit.html">party/edit</a></li><li><a href="party_login.html">party/login</a></li><li><a href="party_profile.html">party/profile</a></li><li><a href="party_register.html">party/register</a></li><li><a href="party_reset.html">party/reset</a></li><li><a href="party_search.html">party/search</a></li><li><a href="party_view.html">party/view</a></li><li><a href="site_home.html">site/home</a></li><li><a href="site_search.html">site/search</a></li><li><a href="volume_activity.html">volume/activity</a></li><li><a href="volume_csv.html">volume/csv</a></li><li><a href="volume_edit.html">volume/edit</a></li><li><a href="volume_search.html">volume/search</a></li><li><a href="volume_slotActivity.html">volume/slotActivity</a></li><li><a href="volume_view.html">volume/view</a></li><li><a href="volume_zip.html">volume/zip</a></li></ul></div><div><h3>Functions</h3><ul><li><a href="-_anonymous_-pre-checkDirty.html">checkDirty</a></li><li><a href="-_anonymous_-pre-form.$setUnsubmitted.html">$setUnsubmitted</a></li><li><a href="-_anonymous_-pre-form.resetAll.html">resetAll</a></li></ul></div>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri May 18 2018 11:45:42 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
